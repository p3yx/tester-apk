<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GitHub Manager</title>
<style>
  body {
    background: #121212;
    color: #f0f0f0;
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 20px;
  }
  h1, p {
    text-align: center;
    margin: 0;
  }
  h1 {
    color: #00e676;
    margin-bottom: 8px;
  }
  p {
    color: #bbb;
    margin-bottom: 24px;
  }
  .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 16px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .box {
    background: #1a1a1a;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 255, 196, 0.1);
    width: 360px;
  }
  label {
    margin-top: 10px;
    margin-bottom: 4px;
    display: block;
    font-size: 14px;
  }
  input, select, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 6px;
    background: #262626;
    color: #eee;
    font-size: 14px;
    box-sizing: border-box;
    margin-bottom: 12px;
  }
  .btn {
    background: #00e6b8;
    color: #000;
    padding: 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.2s ease;
    display: inline-block;
    margin: 4px 4px 8px 0;
  }
  .btn:hover {
    background: #00bfa5;
  }
  .btn-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
  }
  .loading {
    display: none;
    text-align: center;
    color: #00ffc4;
    margin-top: 12px;
  }
  .preview {
    white-space: pre-wrap;
    background: #1e1e1e;
    border-radius: 6px;
    padding: 12px;
    margin-top: 12px;
    overflow: auto;
    max-height: 300px;
    font-size: 13px;
    display: none;
  }
  .toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: bold;
    z-index: 999;
    font-size: 14px;
  }
  .success {
    background-color: #28a745;
    color: white;
  }
  .error {
    background-color: #dc3545;
    color: white;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 999;
    padding-top: 300px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
    animation: fadeIn 0.3s ease;
  }
  .modal-content {
    background-color: #1a1a1a;
    margin: auto;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid #888;
    width: 90%;
    max-width: 400px;
    animation: slideDown 0.3s ease;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    text-align: center;
  }
  @keyframes fadeIn {
    from {opacity: 0} to {opacity: 1}
  }
  @keyframes slideDown {
    from {transform: translateY(-20px); opacity: 0}
    to {transform: translateY(0); opacity: 1}
  }
  .modal .btn {
    background-color: #00bfa5;
    color: #1a1a1a;
    padding: 10px 18px;
    margin-top: 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .modal .btn:hover {
    background-color: #c0392b;
  }
  .modal .close {
    float: right;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
  }
  .close {
    float: right;
    font-size: 24px;
    font-weight: bold;
    color: #999;
    cursor: pointer;
  }
  .close:hover {
    color: #fff;
  }
  #editBox {
    display: none;
  }
    footer {
      margin-top: 40px;
      padding: 20px;
      background: #1a1a1a;
      text-align: center;
      border-radius: 10px;
      color: #aaa;
      font-size: 14px;
    }
</style>
</head>
<body>

<h1>GitHub Manager</h1>
<p>Kelola file GitHub langsung dari browser</p>

<div class="container">

  <!-- Token dan Buat Folder -->
  <div class="box">
    <label for="token">GitHub Token</label>
    <input type="text" id="token" placeholder="Masukkan token GitHub">
    <button class="btn" onclick="saveToken()">Simpan Token</button>

    <label>Repo (username/repo)</label>
    <input type="text" id="repo" />
    <label>Branch</label>
    <input type="text" id="branch" value="main" />

  </div>

  <!-- File Manager -->
  <div class="box">
    <h2>File Manager</h2>
    <label>Pilih File</label>
    <select id="fileList"><option value="">-- Pilih file --</option></select>

    <div class="btn-group">
      <button class="btn" onclick="listFiles()">List File</button>
      <button class="btn" onclick="previewFile()">Preview</button>
      <button class="btn" onclick="editFile()">Edit</button>
      <button class="btn" onclick="openRenameModal()">Rename</button>
      <button class="btn" onclick="openDeleteModal()">Hapus</button>
    </div>

    <div id="filePreview" class="preview"></div>

    <label>Pilih File Upload</label>
    <input type="file" id="fileUpload" multiple />
    <label>Folder Tujuan (optional)</label>
    <input type="text" id="folderPath" placeholder="folder/subfolder" />
    <button class="btn" onclick="uploadFiles()">Upload</button>

    <label>Masukan Nama Folder</label>
    <input type="text" id="newFolderName" placeholder="Nama folder baru" />
    <button class="btn" onclick="createFolder()">Buat Folder</button>
    
    <hr style="border: 0; border-top: 1px solid #333; margin: 16px 0;">

    <label>Nama File Baru</label>
    <input type="text" id="newFileInput" placeholder="contoh.txt" />
    <textarea id="newFileContent" rows="5" placeholder="Isi file baru..."></textarea>
    <button class="btn" onclick="createFile()">Buat File</button>
  </div>

  <!-- Edit File -->
  <div class="box" id="editBox">
    <h2>Edit File</h2>
    <label>Path</label>
    <input type="text" id="filePath" readonly />
    <label>Isi File</label>
    <textarea id="fileContent" rows="10"></textarea>
    <div class="btn-group">
      <button class="btn" onclick="saveFile()">Simpan</button>
      <button class="btn" onclick="cancelEdit()">Batal</button>
    </div>
  </div>

</div>

<div class="loading" id="loading">Memproses...</div>

<!-- Modal Rename -->
<div id="renameModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeRenameModal()">&times;</span>
    <h2>Ganti Nama File</h2>
    <input type="text" id="newFileName" placeholder="Masukkan nama baru" />
    <button class="btn" onclick="confirmRename()">Ganti Nama</button>
  </div>
</div>

<!-- Modal Hapus -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeDeleteModal()">&times;</span>
    <h2>Konfirmasi Hapus</h2>
    <p>Apakah Anda yakin ingin menghapus file ini?</p>
    <p id="deleteFileName" style="font-weight:bold;"></p>
    <button class="btn" onclick="confirmDelete()">Ya, Hapus</button>
  </div>
</div>

<footer id="kontak">
  <p>Â© 2025 PeyxDev - All Rights Reserved</p>
</footer>

  <script>
    const GITHUB_API = "https://api.github.com";
    const tokenInput = document.getElementById("token");
    let currentRenamePath = "";

    window.onload = () => {
      const savedToken = localStorage.getItem("github_token");
      if (savedToken) tokenInput.value = savedToken;
    };

    function getVal(id) {
      return document.getElementById(id).value.trim();
    }

    function showToast(msg, type = "success") {
      const el = document.createElement("div");
      el.className = `toast ${type}`;
      el.innerText = msg;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 3000);
    }

    function loading(state) {
      document.getElementById("loading").style.display = state ? "block" : "none";
    }

    function saveToken() {
      const token = tokenInput.value.trim();
      if (!token) return showToast("Token kosong!", "error");
      localStorage.setItem("github_token", token);
      showToast("Token disimpan!", "success");
    }

    async function listFiles() {
      const token = getVal("token"), repo = getVal("repo"), branch = getVal("branch"), path = getVal("folderPath");
      if (!token || !repo) return showToast("Token dan repo wajib diisi", "error");
      try {
        loading(true);
        const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const sel = document.getElementById("fileList");
        sel.innerHTML = `<option value="">-- Pilih file --</option>`;
        data.forEach(file => {
          if (file.type === "file") {
            const opt = document.createElement("option");
            opt.value = file.path;
            opt.text = file.name;
            sel.appendChild(opt);
          }
        });
        showToast("File dimuat");
      } catch (e) {
        showToast("Gagal: " + e.message, "error");
      } finally {
        loading(false);
      }
    }

    async function previewFile() {
      const path = getVal("fileList"), token = getVal("token"), repo = getVal("repo"), branch = getVal("branch");
      if (!path) return;
      try {
        const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const preview = atob(data.content.replace(/\n/g, ""));
        const previewEl = document.getElementById("filePreview");
        previewEl.innerText = preview;
        previewEl.style.display = "block";
      } catch {
        document.getElementById("filePreview").innerText = "Gagal memuat isi file";
      }
    }

    function cancelEdit() {
      document.getElementById("editBox").style.display = "none";
      document.getElementById("filePath").value = '';
      document.getElementById("fileContent").value = '';
    }

    async function editFile() {
      const path = getVal("fileList"), token = getVal("token"), repo = getVal("repo"), branch = getVal("branch");
      if (!path) return showToast("Pilih file terlebih dahulu", "error");
      try {
        loading(true);
        const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const content = atob(data.content.replace(/\n/g, ""));
        document.getElementById("editBox").style.display = "block";
        document.getElementById("filePath").value = path;
        document.getElementById("fileContent").value = content;
      } catch (e) {
        showToast("Gagal memuat file untuk diedit: " + e.message, "error");
      } finally {
        loading(false);
      }
    }

    async function saveFile() {
      const token = getVal("token"), repo = getVal("repo"), branch = getVal("branch");
      const path = getVal("filePath"), content = getVal("fileContent");
      if (!path || !content) return showToast("File path dan isi file wajib diisi", "error");
      try {
        loading(true);
        const shaRes = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
          headers: { Authorization: `token ${token}` }
        });
        const shaData = await shaRes.json();
        const sha = shaData.sha;

        const updateRes = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}`, {
          method: "PUT",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Update file content",
            content: btoa(content),
            sha: sha
          })
        });

        const updateData = await updateRes.json();
        if (updateData.content) {
          showToast("File berhasil disimpan", "success");
          cancelEdit();
        }
      } catch (e) {
        showToast("Gagal menyimpan file: " + e.message, "error");
      } finally {
        loading(false);
      }
    }

    function openRenameModal() {
      const selectedFile = getVal("fileList");
      if (!selectedFile) return showToast("Pilih file terlebih dahulu", "error");
      currentRenamePath = selectedFile;
      document.getElementById("renameModal").style.display = "block";
    }

    function closeRenameModal() {
      document.getElementById("renameModal").style.display = "none";
      document.getElementById("newFileName").value = "";
    }

    async function confirmRename() {
      const newName = getVal("newFileName");
      const token = getVal("token");
      const repo = getVal("repo");
      const branch = getVal("branch");
      const path = currentRenamePath;

      if (!newName) return showToast("Nama baru tidak boleh kosong", "error");

      try {
        loading(true);
        const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const sha = data.sha;
        const folder = path.includes("/") ? path.substring(0, path.lastIndexOf("/")) : "";
        const newPath = folder ? `${folder}/${newName}` : newName;

        await fetch(`${GITHUB_API}/repos/${repo}/contents/${newPath}`, {
          method: "PUT",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Rename file",
            content: data.content,
            sha: sha
          })
        });

        await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}`, {
          method: "DELETE",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Menghapus file lama setelah rename",
            sha: sha
          })
        });

        showToast("File berhasil diganti nama", "success");
        listFiles();
        closeRenameModal();
      } catch (e) {
        showToast("Gagal mengganti nama file: " + e.message, "error");
      } finally {
        loading(false);
      }
    }
    
 function openDeleteModal() {
  const selectedFile = getVal("fileList");
  if (!selectedFile) return showToast("Pilih file terlebih dahulu", "error");
  document.getElementById("deleteFileName").innerText = selectedFile;
  document.getElementById("deleteModal").style.display = "block";
}

function closeDeleteModal() {
  document.getElementById("deleteModal").style.display = "none";
  document.getElementById("deleteFileName").innerText = "";
}

async function confirmDelete() {
  const token = getVal("token");
  const repo = getVal("repo");
  const branch = getVal("branch");
  const path = document.getElementById("deleteFileName").innerText;

  if (!token || !repo || !path) return showToast("Data tidak lengkap", "error");

  try {
    loading(true);
    const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}?ref=${branch}`, {
      headers: { Authorization: `token ${token}` }
    });
    const data = await res.json();
    const sha = data.sha;

    const delRes = await fetch(`${GITHUB_API}/repos/${repo}/contents/${path}`, {
      method: "DELETE",
      headers: {
        Authorization: `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Hapus file ${path}`,
        sha: sha
      })
    });

    if (delRes.ok) {
      showToast("File berhasil dihapus", "success");
      closeDeleteModal();
      listFiles();
      document.getElementById("filePreview").style.display = "none";
    } else {
      const err = await delRes.json();
      throw new Error(err.message || "Gagal menghapus");
    }
  } catch (e) {
    showToast("Gagal menghapus: " + e.message, "error");
  } finally {
    loading(false);
  }
}

    async function createFolder() {
      const folder = getVal("folderPath");
      const name = getVal("newFolderName").replace(/\/+$/, '');
      const fullPath = folder ? `${folder}/${name}` : name;
      const token = getVal("token"), repo = getVal("repo"), branch = getVal("branch");
      if (!name) return showToast("Nama folder wajib diisi", "error");

      try {
        loading(true);
        await fetch(`${GITHUB_API}/repos/${repo}/contents/${fullPath}/.keep`, {
          method: "PUT",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Create folder (dengan .keep)",
            content: btoa("folder placeholder"),
            branch: branch
          })
        });
        showToast("Folder berhasil dibuat", "success");
        listFiles();
      } catch (e) {
        showToast("Gagal membuat folder: " + e.message, "error");
      } finally {
        loading(false);
      }
    }
   
   async function uploadFiles() {
  const files = document.getElementById("fileUpload").files;
  const token = getVal("token");
  const repo = getVal("repo");
  const branch = getVal("branch");
  const path = getVal("folderPath");

  if (!token || !repo || files.length === 0) return showToast("Token, repo, dan file wajib diisi", "error");

  loading(true);
  try {
    for (let file of files) {
      const reader = new FileReader();
      const fileName = file.name;
      await new Promise((resolve, reject) => {
        reader.onload = async () => {
          const base64 = reader.result.split(',')[1];
          const filePath = path ? `${path}/${fileName}` : fileName;

          const uploadRes = await fetch(`${GITHUB_API}/repos/${repo}/contents/${filePath}`, {
            method: "PUT",
            headers: {
              Authorization: `token ${token}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              message: `Upload ${fileName}`,
              content: base64,
              branch: branch
            })
          });

          if (!uploadRes.ok) {
            const error = await uploadRes.json();
            showToast(`Gagal upload ${fileName}: ${error.message}`, "error");
            return reject();
          }

          resolve();
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    showToast("Semua file berhasil diupload", "success");
    listFiles();
  } catch (e) {
    showToast("Gagal mengupload file: " + e.message, "error");
  } finally {
    loading(false);
  }
}

async function deleteFile() {
  const filePath = getVal("fileList");
  const token = getVal("token");
  const repo = getVal("repo");
  const branch = getVal("branch");

  if (!filePath) return showToast("Pilih file yang ingin dihapus", "error");

  const confirmDelete = confirm(`Yakin ingin menghapus file "${filePath}"?`);
  if (!confirmDelete) return;

  try {
    loading(true);
    const res = await fetch(`${GITHUB_API}/repos/${repo}/contents/${filePath}?ref=${branch}`, {
      headers: { Authorization: `token ${token}` }
    });

    if (!res.ok) throw new Error("Gagal mendapatkan SHA");

    const data = await res.json();
    const sha = data.sha;

    const delRes = await fetch(`${GITHUB_API}/repos/${repo}/contents/${filePath}`, {
      method: "DELETE",
      headers: {
        Authorization: `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Hapus file ${filePath}`,
        sha: sha,
        branch: branch
      })
    });

    if (!delRes.ok) throw new Error("Gagal menghapus file");

    showToast("File berhasil dihapus", "success");
    listFiles();
  } catch (e) {
    showToast("Gagal menghapus file: " + e.message, "error");
  } finally {
    loading(false);
  }
}
  </script>
</body>
</html>